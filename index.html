<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Escuela Dominical - Vida Kid</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #779eec; margin: 0; padding: 20px; color: #333; }
        .hidden { display: none; }
        header { text-align: center; margin-bottom: 20px; }
        .logo-container { width: 100px; height: 100px; background: white; border-radius: 20px; margin: 0 auto 10px; overflow: hidden; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .logo-container img { width: 100%; height: 100%; object-fit: cover; }
        h1 { color: white; text-shadow: 1px 1px 4px rgba(0,0,0,0.2); font-size: 1.5rem; }
        .table-container { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow-x: auto; }
        .profesores-area { margin-bottom: 20px; display: flex; justify-content: center; background: #f0f2f5; padding: 15px; border-radius: 10px; }
        .profesores-area input { width: 60%; border: 1px solid #ccc; padding: 10px; border-radius: 5px; text-align: center; font-size: 1rem; background: #fff; }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        th { background: #e6e9ff; color: #4f46e5; font-size: 0.8rem; padding: 12px; border: 1px solid #eee; }
        td { padding: 8px; border: 1px solid #eee; text-align: center; }
        .fila-contacto { background: #fdfdfd; font-size: 0.85rem; }
        .contacto-grid { display: flex; gap: 20px; padding: 10px; justify-content: center; align-items: center; }
        .input-group { display: flex; flex-direction: column; text-align: left; }
        .input-group label { font-weight: bold; color: #666; font-size: 0.75rem; margin-bottom: 4px; }
        input[type="text"], input[type="number"], select, textarea { padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
        .total-celda { font-weight: bold; color: #4f46e5; font-size: 1.1rem; }
        .observaciones-container { margin-top: 20px; text-align: left; }
        .observaciones-container label { font-weight: bold; color: #4f46e5; display: block; margin-bottom: 5px; }
        .observaciones-container textarea { width: 100%; height: 80px; resize: none; border: 1px solid #ddd; box-sizing: border-box; }
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-add { background: #4caf50; color: white; margin-top: 15px; }
        .footer-controls { display: flex; justify-content: flex-end; margin-top: 20px; }
        .btn-save { background: #1a4293; color: white; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-save:hover { background: #133270; }
        .btn-delete { background: #ff4d4d; color: white; border: none; border-radius: 5px; padding: 5px 12px; cursor: pointer; font-size: 1.1rem; }
        .back { cursor: pointer; color: white; margin-bottom: 15px; display: inline-block; font-weight: bold; text-decoration: underline; }
        .cards { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .card { background: white; padding: 25px; border-radius: 15px; cursor: pointer; min-width: 180px; text-align: center; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

<section id="pagina-jornadas">
    <header>
        <div class="logo-container"><img src="vida kid.jpeg" alt="Logo"></div>
        <h1>Lista de estudiantes Vida Kids</h1>
    </header>
    <div class="cards">
        <div class="card" onclick="irEdades('8:00 a 10:00')">Jornada de 8:00 a 10:00</div>
        <div class="card" onclick="irEdades('11:00 a 13:00')">Jornada de 11:00 a 13:00</div>
    </div>
</section>

<section id="pagina-edades" class="hidden">
    <div class="back" onclick="nav('pagina-edades','pagina-jornadas')">‚Üê Volver</div>
    <h2 id="titulo-jornada" style="color: white; text-align: center;"></h2>
    <div class="cards">
        <div class="card" onclick="irTabla('3 a 6 a√±os')">De 3 a 6 a√±os</div>
        <div class="card" onclick="irTabla('7 a 9 a√±os')">De 7 a 9 a√±os</div>
    </div>
</section>

<section id="pagina-tabla" class="hidden">
    <div class="back" onclick="nav('pagina-tabla','pagina-edades')">‚Üê Volver</div>
    <h2 id="titulo-clase" style="color: white; text-align: center;"></h2>
    <div class="table-container">
        <div class="profesores-area">
            <input type="text" id="inputProfesor" placeholder="Nombre del profesor...">
        </div>
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Nombre del Estudiante</th>
                    <th>Biblia (10)</th>
                    <th>Cuaderno (10)</th>
                    <th>Ofrenda (10)</th>
                    <th>Vers√≠culo (10)</th>
                    <th>Coraz√≥n Dispuesto (10)</th>
                    <th>Total</th>
                    <th>Acci√≥n</th>
                </tr>
            </thead>
            <tbody id="tablaAlumnos"></tbody>
        </table>
        <button class="btn btn-add" onclick="agregarFila()">‚ûï Agregar alumno</button>
        
        <div class="observaciones-container">
            <label>Observaciones de la clase:</label>
            <textarea id="txtObservaciones" placeholder="Escriba aqu√≠ las observaciones..."></textarea>
        </div>

        <div class="footer-controls">
            <button class="btn btn-save" onclick="guardar()">üíæ Guardar Todo</button>
        </div>
    </div>
</section>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "TU_API_KEY", 
    authDomain: "vida-kids-ca4b8.firebaseapp.com",
    projectId: "vida-kids-ca4b8",
    storageBucket: "vida-kids-ca4b8.firebasestorage.app",
    messagingSenderId: "287435029924",
    appId: "1:287435029924:web:0a92a25e151f6187089531",
    measurementId: "G-MXL7RB9H39"
  };

  const app = initializeApp(firebaseConfig);
  window.db = getFirestore(app);
</script>

<script>
let jornada = "", clase = "";

// INFORMACI√ìN DE PROFESORES ACTUALIZADA
const profesoresPorGrupo = {
    "8:00 a 10:00_3 a 6 a√±os": "Laura y Sarita",
    "8:00 a 10:00_7 a 9 a√±os": "Charles y Erika",
    "11:00 a 13:00_3 a 6 a√±os": "Mayerly y Martha",
    "11:00 a 13:00_7 a 9 a√±os": "Claudia y Paola"
};

function nav(ocultar, mostrar) {
    document.getElementById(ocultar).classList.add('hidden');
    document.getElementById(mostrar).classList.remove('hidden');
}

function irEdades(j) {
    jornada = j;
    document.getElementById('titulo-jornada').innerText = "Jornada: " + j;
    nav('pagina-jornadas', 'pagina-edades');
}

function irTabla(c) {
    clase = c;
    document.getElementById('titulo-clase').innerText = `Clase: ${c} (${jornada})`;
    nav('pagina-edades', 'pagina-tabla');
    
    // Asignaci√≥n autom√°tica de profesor
    const keyProfesor = `${jornada}_${clase}`;
    document.getElementById('inputProfesor').value = profesoresPorGrupo[keyProfesor] || "";
    
    cargar();
}

function agregarFila(d = {}) {
    const tabla = document.getElementById('tablaAlumnos');
    const index = Math.floor(tabla.rows.length / 2) + 1;
    const p = d.puntos ? d.puntos.map(val => isNaN(parseInt(val)) ? 0 : parseInt(val)) : [0,0,0,0,0];
    const total = p.reduce((a, b) => a + b, 0);
    
    const f1 = document.createElement('tr');
    f1.innerHTML = `
        <td><strong>${index}</strong></td>
        <td><input type="text" class="nombre" value="${d.nombre || ''}" placeholder="Nombre del estudiante" style="width:200px"></td>
        <td><input type="number" class="punto" value="${p[0]}" onchange="calc(this)" min="0" max="10" style="width:50px"></td>
        <td><input type="number" class="punto" value="${p[1]}" onchange="calc(this)" min="0" max="10" style="width:50px"></td>
        <td><input type="number" class="punto" value="${p[2]}" onchange="calc(this)" min="0" max="10" style="width:50px"></td>
        <td><input type="number" class="punto" value="${p[3]}" onchange="calc(this)" min="0" max="10" style="width:50px"></td>
        <td><input type="number" class="punto" value="${p[4]}" onchange="calc(this)" min="0" max="10" style="width:50px"></td>
        <td class="total-celda">${total}</td>
        <td><button class="btn-delete" onclick="borrar(this)">‚úï</button></td>`;

    const f2 = document.createElement('tr');
    f2.className = "fila-contacto";
    f2.innerHTML = `
        <td colspan="9">
            <div class="contacto-grid">
                <div class="input-group">
                    <label>Acudiente:</label>
                    <input type="text" class="acudiente" value="${d.acudiente || ''}" placeholder="Nombre del acudiente" style="width:250px">
                </div>
                <div class="input-group">
                    <label>Tel√©fono:</label>
                    <input type="text" class="tel" value="${d.tel || ''}" placeholder="N√∫mero de celular">
                </div>
                <div class="input-group">
                    <label>¬øAutoriza Fotos?</label>
                    <select class="autoriza">
                        <option value="No" ${d.autoriza === 'No' ? 'selected' : ''}>No</option>
                        <option value="S√≠" ${d.autoriza === 'S√≠' ? 'selected' : ''}>S√≠</option>
                    </select>
                </div>
            </div>
        </td>`;
    
    tabla.appendChild(f1);
    tabla.appendChild(f2);
}

function calc(el) {
    const row = el.closest('tr');
    const pts = row.querySelectorAll('.punto');
    let sum = 0;
    pts.forEach(p => {
        let val = parseInt(p.value);
        sum += isNaN(val) ? 0 : val;
    });
    row.querySelector('.total-celda').innerText = sum;
}

function borrar(btn) {
    if(confirm("¬øEliminar este estudiante?")) {
        const r1 = btn.closest('tr');
        const r2 = r1.nextElementSibling;
        r1.remove();
        r2.remove();
        Array.from(document.querySelectorAll('#tablaAlumnos tr:nth-child(odd)')).forEach((r, i) => r.cells[0].innerText = i + 1);
    }
}

async function guardar() {
    if (!window.db) { alert("Error de conexi√≥n"); return; }
    const rows1 = document.querySelectorAll('#tablaAlumnos tr:nth-child(odd)');
    const rows2 = document.querySelectorAll('#tablaAlumnos tr:nth-child(even)');
    const alumnos = [];
    rows1.forEach((r, i) => {
        alumnos.push({
            nombre: r.querySelector('.nombre').value,
            puntos: Array.from(r.querySelectorAll('.punto')).map(p => p.value),
            acudiente: rows2[i].querySelector('.acudiente').value,
            tel: rows2[i].querySelector('.tel').value,
            autoriza: rows2[i].querySelector('.autoriza').value
        });
    });
    try {
        const { collection, addDoc } = await import("https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js");
        await addDoc(collection(window.db, "clases"), {
            jornada, clase, alumnos, 
            profesor: document.getElementById('inputProfesor').value,
            observaciones: document.getElementById('txtObservaciones').value,
            timestamp: new Date()
        });
        localStorage.setItem(`vKid_${jornada}_${clase}`, JSON.stringify({
            profe: document.getElementById('inputProfesor').value,
            ni√±os: alumnos,
            observaciones: document.getElementById('txtObservaciones').value
        }));
        alert("¬°Guardado en la nube! ‚úÖ");
    } catch (e) { alert("Error al guardar"); }
}

function cargar() {
    const t = document.getElementById('tablaAlumnos');
    t.innerHTML = "";
    const data = JSON.parse(localStorage.getItem(`vKid_${jornada}_${clase}`));
    if(data && data.ni√±os && data.ni√±os.length > 0) {
        document.getElementById('inputProfesor').value = data.profe || "";
        document.getElementById('txtObservaciones').value = data.observaciones || "";
        data.ni√±os.forEach(n => agregarFila(n));
    } else {
        agregarFila();
    }
}
</script>
</body>
</html>